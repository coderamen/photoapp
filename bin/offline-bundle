#!/usr/bin/env bash
set -euo pipefail

APP_ROOT=$(cd "$(dirname "$0")/.." && pwd)
cd "$APP_ROOT"

CACHE_DIR="$APP_ROOT/vendor/cache"

mkdir -p "$CACHE_DIR"

if ! ls "$CACHE_DIR"/*.gem >/dev/null 2>&1; then
  cat >&2 <<'EOF'
No vendor/cache gem files found.

Populate vendor/cache with the required .gem files (for example by running
`bundle package --all` on a machine with internet access) and re-run this
script.
EOF
  exit 1
fi

bundle config set --local path "vendor/bundle"
bundle config set --local deployment 'true'
bundle install --local --jobs 4
